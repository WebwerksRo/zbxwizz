<!DOCTYPE html>
<html>
<head>
    <style>
        #container>div{
            width: 100px;
            border: dashed black 1px;
            margin: 5px; padding: 5px;
        }
		
		div>strong {
			display: inline-block;
			padding: 3px;
			background: #eee;
			border-radius: 3px;
			border: solid black 1px;
			margin: 3px;
		}
		
		.found{
			color: green;
		}
		.notfound{
			color: red;
		}
		.isproto{
			font-style: italic;
			background: white;
		}
		
    </style>
</head>
<body>
<form>
    <fieldset>
        <legend>Zabbix API</legend>
		<label style="display: block">
			URL<br>
			<input type="text" id="apiUrlInput" value="https://res.rwe.com/zabbix/api_jsonrpc.php" style="width: 100%;">
			<!-- <input type="text" id="apiUrlInput" value="http://10.112.61.140/zabbix/api_jsonrpc.php"> -->
		</label>
		
		<label style="display: block">
			Key<br>
			<input type="text" id="apiKeyInput" value=""  style="width: 100%;">
		</label>
        <button id="btn" type="button" onclick="run()">Run</button>
    </fieldset>
</form>
<textarea id="logs" style="width: 100%">
</textarea>
<script src="lib/jquery.js"></script>
<script src="lib/zbx.js"></script>
<script>
let zbx,apiUrl,apiKey;
$.get("./zbx_api_key.txt").then(data=>{
	$('#apiKeyInput').val(data);
});


function run2() {
	var settings = {
  "url": "https://res.rwe.com/zabbix/api_jsonrpc.php",
  "method": "POST",
  "timeout": 0,
  "headers": {
    "Content-Type": "application/json",
	"Authorization": "Bearer 45ae9885e6c10d8963b62fcbda69f63a5af789292c5541c184b95b869fb53dce"
  },
  "data": JSON.stringify({
    "jsonrpc": "2.0",
    "method": "host.get",
    "params": {
      "filter": {
        "host": [
          "MGMT15170"
        ]
      }
    },
    "id": 1
  }),
};

$.ajax(settings).done(function (response) {
  console.log(response);
});
}
function run() {
	zbx = new ZBXApi($("#apiUrlInput").val(),$('#apiKeyInput').val());
	let output = $("#logs")[0];
	let buffer = [];

	
	zbx.get("item",{
			output: ["key_","name","hostid","templateid"],
			output: 'extend',
			//output: "extend",
			limit: 10,
			//itemids: 99472,
			filter:{
				//itemid: 99472,
				type: 2,
			}
		})
		.done((resp)=>{
			console.log(resp);
			return;
			resp.result.forEach((item)=>{
				zbx.get("host",{
						output: ["host","name"],
						hostids: item.hostid
					},false)
					.done((data)=>{
						if(!data.result.length) return;
						let resultItem = item;
						
						resultItem.hostName = data.result[0].host;
						resultItem.hostVisibleName = data.result[0].name;
						output.value += Object.values(resultItem).join(";")+"\n";
					})
			});
			
		});
}



</script>
</body>
</html>

<!--
	POST /zabbix/api_jsonrpc.php HTTP/2
Host: res.rwe.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/115.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: http://localhost:5050/
Content-Length: 73
Origin: http://localhost:5050
DNT: 1
Connection: keep-alive
Sec-Fetch-Dest: image
Sec-Fetch-Mode: no-cors
Sec-Fetch-Site: cross-site
TE: trailers
Content-Type: application/json
Authorization: Bearer 45ae9885e6c10d8963b62fcbda69f63a5af789292c5541c184b95b869fb53dce
Pragma: no-cache
Cache-Control: no-cache
-->
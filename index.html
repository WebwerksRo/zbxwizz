<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/select2.min.css">
    <link rel="stylesheet" href="assets/style.css">
    <link rel="stylesheet" href="assets/css/jsoneditor.css">
    <link rel="stylesheet" href="assets/css/jquery-ui.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=SUSE:wght@100..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/font-awesome/css/font-awesome.min.css">
    <title>ZbxWizz</title>
    <style>


    </style>
</head>
<body>
    <div style="width: 100vw; height: 100vh; display: flex;flex-direction:column;">
        <nav class="navbar navbar-expand-md navbar-dark bg-secondary" id="top">
            <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fa fa-bars"></i>
            </button>

            <div class="navbar-collapse collapse" id="navbarsExample04" style="">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" role="button" data-toggle="dropdown" aria-expanded="false" ondummymouseover="$(this).dropdown('toggle')">
                            Environment
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#" role="button" onclick="worksheets.reset()">New</a>
                            <a class="dropdown-item" href="#" role="button" onclick="save_env(true)">Save</a>
                            <a class="dropdown-item" role="button" data-toggle="modal" data-target="#load_env">Load</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" role="button" data-toggle="dropdown" aria-expanded="false" ondummymouseover="$(this).dropdown('toggle')">
                            Data
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" role="button" data-toggle="modal" data-target="#importCsvModal">Import CSV</a>
                            <a class="dropdown-item" role="button" onclick="alert_modal('Not yet implemented')">Import Excel</a>
                            <a class="dropdown-item" role="button" onclick="req_modal('#importZbxForm','Import data from Zabbix',req_import_from_api,worksheets.get_active(),{attrs:{style: 'width: 500px; height: 650px !important'}},false)">Import from Zabbix</a>
                            <a class="dropdown-item" role="button" onclick="req_modal('#importJsForm','Import from JavaScript',req_import_js,worksheets.get_active(),{attrs:{style: 'width: 500px; height: 650px !important'}},false)">Import from JavaScript</a>

                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" role="button"  href="#" onclick="prompt_save_data()">Export to CSV</a>
                            <a class="dropdown-item" role="button" onclick="alert_modal('Not yet implemented')">Export JSON</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" role="button" data-toggle="dropdown" aria-expanded="false" ondummymouseover="$(this).dropdown('toggle')">
                            Table ops
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" href="#" role="button" onclick="worksheets.get_active().add_rows_dialog()">Add rows</a>
                            <a class="dropdown-item" href="#" onclick="worksheets.get_active().reorder_columns_dialog()">Reorder columns</a>
                            <a class="dropdown-item" href="#" onclick="worksheets.get_active().copy_to_new_sheet_dialog()">Copy to new sheet</a>
                        </div>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" role="button" data-toggle="dropdown" aria-expanded="false" ondummymouseover="$(this).dropdown('toggle')">
                            Zabbix ops
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" role="button" onclick="req_modal('#pullZbxForm','Pull data from Zabbix',req_pull,worksheets.get_active(),{attrs:{style: 'width: 500px; height: 650px !important'}})">Pull</a>
                            <a class="dropdown-item" role="button" onclick="req_modal('#pushZbxForm','Push data to Zabbix',push_to_api,worksheets.get_active(),{attrs:{style: 'width: 500px; height: 650px !important'}})">Push</a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle active" href="#" role="button" data-toggle="dropdown" aria-expanded="false" ondummymouseover="$(this).dropdown('toggle')">
                            Tools
                        </a>
                        <div class="dropdown-menu">
                            <a class="dropdown-item" role="button"  href="#" onclick="save_structure()">Save table structure</a>
                            <a class="dropdown-item" role="button"  href="#" onclick="manage_struct()">Restore table structure</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" role="button"  href="#" onclick="open_play_editor()">Script editor</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" role="button"  href="#" onclick="under_development()">Settings</a>

                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" role="button"  href="#" onclick="under_development()">Help</a>
                        </div>
                    </li>
                </ul>
                <a class="nav-link" href="#"  role="button" data-toggle="modal" data-target="#zbxConfigModal"><img src="assets/img/zbx_logo.png" width="30" id="zbxLogo" class="notConnected" alt="API Conn"></a>
                <a class="btn btn-outline-warning" href="https://www.zabbix.com/documentation/current/en/manual/api"  target="_blank"><i class="fa fa-question"></i></a>
            </div>
        </nav>
        <div class="tab-content" id="worksheets"></div>
        <footer class="footer bg-secondary border-top border-dark">
            <div class="container-fluid p-1 d-flex" >
                <div class="flex-grow-1" style="overflow: auto;">

                    <div class="d-inline-block">
                        <ul class="nav nav-pills" id="sheetSelector" role="tablist" data-lastassigned="1"></ul>
                    </div>
                    <button onclick="worksheets.new_sheet()" class="btn btn-info btn-sm addremove"><i class="fa fa-plus"></i> <span>New sheet</span></button>
                    <button onclick="worksheets.delete_sheet()" class="btn btn-danger btn-sm addremove"><i class="fa fa-minus"></i><span> Remove current sheet</span></button>
                </div>
                <div onclick="worksheets.update_stats()" style="min-width: 250px !important;">
                    <a href="#" onclick="$ws.scrollTop(0).scrollLeft(0)" title="To top"><i class="fa fa-arrow-up text-white"></i></a>
                    <a href="#" onclick="save_session(true)" title="To top"><i class="fa fa-save text-white"></i></a>
                    <span class="badge badge-light mr-1">Total: <span class="badge badge-secondary" id="totalRecs">123</span></span>
                    <span class="badge badge-light mr-1">Selected: <span class="badge badge-success" id="totalSelected">123</span></span>
                    <span class="badge badge-light mr-1">Visible: <span class="badge badge-danger" id="totalVisible">123</span></span>
                </div>
    <!--            <button onclick="worksheets.reset()">[x] Reset</button>-->
            </div>
            
        </footer>
    </div>

    <div class="d-none">
        <div id="tranformDialog" title="Transform">
            <label>
                Saved xpressions<br>
                <select style="width: 100%"></select>
            </label>
            <label>
                Xpression<br>
                <textarea style="width: 100%"></textarea>
            </label>
            <label>
                Preview<br>
                <textarea style="width: 100%"></textarea>
            </label>
        </div>
        <div class="card" >
            <div class="card-header">Title</div>
            <div class="card-body">
                body
            </div>
            <div class="card-footer">
                <button class="btn btn-secondary">Click me</button>
            </div>
        </div>
        <div id="scriptPlayer">
            <div class="alert alert-secondary">
                <input type="file" id="scriptFile">
            </div>
            <div id="editor"></div>
            <textarea disabled id="scriptDebug" style="width: 100%;"></textarea>
        </div>

        <div class="vertical-center emptyDataTablePlaceholder" id="emptyDataTable">
            <div class="d-inline-block text-center" style="width: 500px">
                <button onclick='' style='width: 200px !important; display: inline-block  !important;' data-toggle='modal' data-target='#importCsvModal'>Import from CSV</button>
                <button style='width: 200px !important; display: inline-block  !important;' onclick="req_modal('#importZbxForm','Import data from Zabbix',req_import_from_api,worksheets.get_active(),{attrs:{style: 'width: 500px; height: 650px !important'}},false)">Import from Zabbix</button>
                <button onclick='' style='width: 200px !important; display: inline-block  !important;' data-toggle='modal' data-target='#importJSModal'>Import from JavaScript</button>
            </div>
        </div>
    </div>

    <div class="d-none">
        <form id="importZbxForm" disabled="">
            <div class="form-row">
                <div class="col">
                    <div class="form-group ">
                        <label>Resource</label>
                        <div class="input-group">
                            <select class="custom-select custom-select-sm" name="resource"  onchange="update_help_link(this,$(this).val(),'get')">
                                <option></option>
                                <option>host</option>
                                <option>hostgroup</option>
                                <option>template</option>
                                <option>item</option>
                                <option>history</option>
                                <option>trigger</option>
                            </select>
                            <div  class="input-group-append">
                                <a class="btn btn-secondary btn-sm zbxapihelp" href="https://www.zabbix.com/documentation/current/en/manual/api/reference" target="_blank"><i class="fa fa-question"></i></a>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="form-group">
                <label>Request templates</label>
                <div class="input-group mb-2">
                    <select class="custom-select custom-select-sm" onchange="load_req_tpl($(this).parents('form').children('.jsoneditorcontainer').data('editor'),$(this).val())" onclick="load_templates(event,'importReqTpl_')" name="templates"></select>
                    <div class="input-group-append">
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-success" onclick="save_req_tpl('importReqTpl_',$(this).parents('form').children('.jsoneditorcontainer').data('editor'),$(this).val())" type="button">Save</button>
                            <button class="btn btn-danger" onclick="remove_template(this)" type="button">Remove</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jsoneditorcontainer" style="height: 300px;"></div>
            <div class="preview alert alert-secondary mt-1 mb-1">
                <pre>Preview</pre>
            </div>
        </form>

        <form id="pullZbxForm">
            <div class="form-row">
                <div class="col">
                    <div class="form-group ">
                        <label>Resource</label>
                        <div class="input-group">
                            <select class="custom-select custom-select-sm" name="resource" onchange="update_help_link(this,$(this).val(),'get')">
                                <option></option>
                                <option>host</option>
                                <option>hostgroup</option>
                                <option>template</option>
                                <option>item</option>
                                <option>history</option>
                                <option>trigger</option>
                            </select>
                            <div  class="input-group-append">
                                <a class="btn btn-secondary btn-sm zbxapihelp" href="https://www.zabbix.com/documentation/current/en/manual/api/reference" target="_blank"><i class="fa fa-question"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>Post process</label>
                        <select class="custom-select custom-select-sm" name="postprocess">
                            <option value="update">Update existing</option>
                            <option value="new">New data</option>
                            <option value="ignore">Ignore</option>
                        </select>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>Data label</label>
                        <input type="text" name="label" value="zbx" class="form-control form-control-sm">
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Request templates</label>
                <div class="input-group mb-2">
                    <select class="custom-select custom-select-sm" onchange="load_req_tpl($(this).parents('form').children('.jsoneditorcontainer').data('editor'),$(this).val())" onclick="load_templates(event,'pullReqTpl_')" name="templates"></select>
                    <div class="input-group-append">
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-success" onclick="save_req_tpl('pullReqTpl_',$(this).parents('form').children('.jsoneditorcontainer').data('editor'),$(this).val())" type="button">Save</button>
                            <button class="btn btn-danger" onclick="remove_template(this)" type="button">Remove</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jsoneditorcontainer" style="height: 300px;"></div>
            <div class="preview alert alert-secondary mt-1 mb-1">
                <pre>Start typing</pre>
            </div>
        </form>

        <form id="pushZbxForm">
            <div class="form-row">
                <div class="col">
                    <div class="form-group ">
                        <label>Resource</label>
                        <div class="input-group">
                            <select class="custom-select custom-select-sm" name="resource"  onchange="update_help_link(this,$(this).val(),$(this.form.operation).val())">
                                <option></option>
                                <option>host</option>
                                <option>hostgroup</option>
                                <option>template</option>
                                <option>item</option>
                                <option>history</option>
                                <option>trigger</option>
                            </select>
                            <div  class="input-group-append">
                                <a class="btn btn-secondary btn-sm zbxapihelp" href="https://www.zabbix.com/documentation/current/en/manual/api/reference" target="_blank"><i class="fa fa-question"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label>Operation</label>
                        <select class="custom-select custom-select-sm" name="operation"  onchange="update_help_link(this,$(this.form.resource).val(),$(this).val())">
                            <option>update</option>
                            <option>create</option>
                            <option>delete</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Request templates</label>
                <div class="input-group mb-2">
                    <select class="custom-select custom-select-sm" onchange="load_req_tpl($(this).parents('form').children('.jsoneditorcontainer').data('editor'),$(this).val())" onclick="load_templates(event,'pushReqTpl_')" name="templates"></select>
                    <div class="input-group-append">
                        <div class="btn-group btn-group-sm">
                            <button class="btn btn-success" onclick="save_req_tpl('pushReqTpl_',$(this).parents('form').children('.jsoneditorcontainer').data('editor'),$(this).val())" type="button">Save</button>
                            <button class="btn btn-danger" onclick="remove_template(this)" type="button">Remove</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jsoneditorcontainer" style="height: 300px;"></div>
            <div class="preview alert alert-secondary mt-1">
                <pre>preview</pre>
            </div>
        </form>

        <form id="importJsForm" disabled="">
            <div class="form-group">
                <label>Request templates</label>
                <div class="input-group mb-2">
                    <select class="custom-select" onchange="load_req_tpl(importJSTplEditor,$(this).val())" id="importJSTemplates" name="templates"></select>
                    <div class="input-group-append">
                        <div class="btn-group">
                            <button class="btn btn-success" onclick="save_req_tpl('importJSTplPfx_',$(this).parents('form').children('.jsoneditorcontainer').data('editor'),$(this).val())" type="button">Save</button>
                            <button class="btn btn-danger" onclick="remove_template(this)" type="button">Remove</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="jsoneditorcontainer" style="height: 300px;"></div>
            <div class="preview alert alert-secondary mt-5">
                <pre>Nothing to show</pre>
            </div>
        </form>
    </div>

    


    <div class="modal" id="importCsvModal">
        <form id="loadCvsForm">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        Load CSV file
                    </div>
                    <div class="modal-body">
                        <input type="file" name="file" accept="text/csv">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="load_csv(this.form.file)">Load</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="modal" id="zbxConfigModal">
        <form id="zbxConfigForm">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        Zabbix connection
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="zbxUrlInput">API URL</label>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" name="url" id="zbxUrlInput">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="zbxTokenInput">API Token</label>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" name="token" id="zbxTokenInput">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="save_zbx_config(this.form)">Save config</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="modal" id="load_env">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <form>
                <div class="modal-header">Load environment</div>
                <div class="modal-body">
                    <input type="file" name="envfile" accept="application/json">
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" onclick="load_env(this.form,$(this).parents('modal'))">Load</button>
                </div>
                </form>
            </div>
        </div>
    </div>



    <div class="modal" id="generic_modal">
        <div class="modal-dialog modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header"></div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-secondary">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div id="overlay" class="overlay">
        <div class="vertical-center">

            <div class="d-inline">
                <div class="spinner-border" role="status">
                    <span class="sr-only message">Loading...</span>
                </div>
                <div><progress id="loading" value="32" max="100" style="display: none; height: 1em;background-color: #eee;border-radius: 2px;box-shadow: 0 2px 5px rgba(0, 0, 0, 0.25) inset;"></progress></div>
            </div>
        </div>
    </div>
    <div id="warning">
        <div class="vertical-center">
            <div class="d-inline-block text-center bg-dark text-white rounded p-5" style="width: 500px">
                <span style="font-size: 100px">&#x2620;</span>
                <h3 class="text-danger">Warning</h3>
                <p><strong>ZbxWizz</strong> is a very powerful (and dangerous) tool to configure the data in large scale (and small as well) <strong>Zabbix&trade;</strong> deployments.</p>
                <p>You can save a lot of time and get your <strong>Bo$$</strong> appreciation (and eventually a raise or a bonus) or you can sign your <strike>death  sentence</strike> resignation by pushing the wrong commands</p>
                <p>As with great power comes great responsibility. Use it wisely and at your own risk! </p>
                <p>So which pill will you choose?</p>
                <button class="badge-pill badge-danger" onclick="run() && localStorage.setItem('userlevel','courageous')">Red pill (be brave!)</button>
                <button class="badge-pill badge-primary" onclick="alert_modal('Enjoy the stake!');window.close()">Blue pill (stay safe!)</button>
            </div>
        </div>
    </div>

<script src="assets/js/jquery.js"></script>
<!--<script src="assets/js/bootstrap.min.js"></script>-->
<script src="assets/js/bootstrap.bundle.js"></script>
<script src="assets/js/papaparse.min.js"></script>
<script src="assets/js/select2.min.js"></script>
<script src="assets/js/jsoneditor.js"></script>
<script src="assets/js/jquery-ui.js"></script>
<script src="assets/js/colResizable-1.6.min.js"></script>
<script src="plugins/zbx.js"></script>
<script src="lib/util.js"></script>
<script src="lib/datatable.js"></script>
<script src="lib/worksheets.js"></script>
<script src="lib/zbxwizz.js"></script>
<script src="assets/ace-builds/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="assets/ace-builds/src-min-noconflict/ext-language_tools.js"></script>
</body>
</html>
